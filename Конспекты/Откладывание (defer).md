# Defer

`defer` откладывает выполнение функции до тех пор пока не завершится окружающая функция. То есть если функция A вызывается c defer внутри B, то она будет выполнена когда B уже заканчит свою работу.

**Важно**
Все аргументы, которые передаются в отложенную функцию, вычисляются сразу (в момент, когда Go "видит" defer). 
Но сама функция (вызов) выполняется позже — когда текущая функция завершает работу.

Обычно defer используют, чтобы автоматически освободить ресурсы, даже если в функции произойдёт ошибка или return раньше времени:
```
file, err := os.Open("data.txt")
if err != nil {
    log.Fatal(err)
}
defer file.Close() // файл закроется при выходе из функции

// читаем файл...
```

Даже если произойдёт return или panic, file.Close() всё равно вызовется.

**Важно**
Вызовы функций с `defer` помещаются в стек и когда окружающая функция завершается вызываются по правилам стека (последним вошел первым вышел).

Отложенные функции могут читать и изменять именованные возвращаемые значения.
В этом примере отложенная функция увеличивает i после возврата функции, поэтому результатом будет 2:
```
func c() (i int) {
    defer func() { i++ }()
    return 1
}
```

Источники
(The Go Blog: Defer, Panic, and Recover)[https://go.dev/blog/defer-panic-and-recover]